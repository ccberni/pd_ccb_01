//==================================================================================
//==                                                                              ==
//== Dac module source                                                            ==
//==                                                                              ==
//==================================================================================

//==================================================================================
//== INCLUDES                                                                     ==
//==================================================================================
#include "dac.h"

//==================================================================================
//== PUBLIC VARIABLES                                                             ==
//==================================================================================

//==================================================================================
//== PRIVATE VARIABLES                                                            ==
//==================================================================================

//==================================================================================
//== PRIVATE FUNCTIONS PROTOTYPES                                                 ==
//==================================================================================

//==================================================================================
//== PUBLIC FUNCTIONS                                                             ==
//==================================================================================
/**
 * @brief Dac init function
 */
void dac_init( void )
{
	HAL_DAC_Start( &hdac1, DAC_CHANNEL_1 );
	HAL_DAC_SetValue( &hdac1, DAC_CHANNEL_1, DAC_ALIGN_12B_R, 0 );
}

/**
 * @brief Dac setter function
 */
void dac_set_value( uint16_t value )
{
	uint16_t aux;

	if ( value > 4095 ) {
		aux = 4095;
	}
	else {
		aux = value;
	}
	HAL_DAC_SetValue( &hdac1, DAC_CHANNEL_1, DAC_ALIGN_12B_R, aux );
}

/**
 * @brief Dac - conversion from voltage to dac unities
 */
uint16_t dac_voltage_to_unities( double value )
{
	uint16_t dac_unities;

#if (USA_LIMITER_DAC == SIM)
	if ( value > DAC_MAX_LIMITED_VOLTAGE ) {
		value = DAC_MAX_LIMITED_VOLTAGE;
	}
#endif
	dac_unities = ( value * DAC_RANGE ) / DAC_MAX_VOLTAGE;
	return dac_unities;
}

//==================================================================================
//== PRIVATE FUNCTIONS                                                            ==
//==================================================================================
